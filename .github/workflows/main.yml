name: Build APK

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # Manual trigger button

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: âš¡ Get Date (for caching)
      id: get-date
      run: |
        echo "date=$(/bin/date -u '+%Y%m%d')" >> $GITHUB_OUTPUT
      shell: bash
    
    - name: ğŸ’¾ Cache Buildozer Global Directory
      uses: actions/cache@v4
      with:
        path: .buildozer_global
        key: buildozer-global-${{ hashFiles('buildozer.spec') }}
    
    - name: ğŸ’¾ Cache Buildozer Directory
      uses: actions/cache@v4
      with:
        path: .buildozer
        key: ${{ runner.os }}-${{ steps.get-date.outputs.date }}-${{ hashFiles('buildozer.spec') }}
    
    - name: ğŸ”¨ Build with Buildozer (Using Action)
      uses: ArtemSBulgakov/buildozer-action@v1
      id: buildozer
      with:
        command: pip3 install --user --upgrade Cython==0.29.33 virtualenv; echo y | buildozer -v android debug
        buildozer_version: stable
    
    - name: ğŸ“¤ Upload APK to Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: APK-Package
        path: ${{ steps.buildozer.outputs.filename }}
        retention-days: 30
    
    - name: âœ… Build Complete
      run: |
        echo "ğŸ‰ APK Build Successful!"
        echo "ğŸ“ APK: ${{ steps.buildozer.outputs.filename }}"
        echo "ğŸ“¥ Download from: Actions â†’ Artifacts"
